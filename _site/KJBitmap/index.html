<!doctype html> <html class="no-js" lang="en"> <head> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <title>深入研究KJBitmap使用方法</title> <link rel="stylesheet" href="/assets/css/styles_feeling_responsive.css"> <script src="/assets/js/modernizr.min.js"></script> <noscript> <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic%7cVolkhov' rel='stylesheet' type='text/css'> </noscript> <meta name="description" content="好像最近一个月都没有写博客了，正好伴着KJFrameForAndroid更新v2.14版本，讲解一下其中Bitmap模块的深度用法。"/> <link rel="author" href="https://plus.google.com/u/0/110645272912875945931"/> <link rel="icon" sizes="32x32" href="/assets/img/favicon-32x32.png"> <link rel="icon" sizes="192x192" href="/assets/img/touch-icon-192x192.png"> <link rel="apple-touch-icon-precomposed" sizes="180x180" href="/assets/img/apple-touch-icon-180x180-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/img/apple-touch-icon-152x152-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/img/apple-touch-icon-144x144-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/img/apple-touch-icon-120x120-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/img/apple-touch-icon-114x114-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/img/apple-touch-icon-76x76-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/img/apple-touch-icon-72x72-precomposed.png"> <link rel="apple-touch-icon-precomposed" href="/assets/img/apple-touch-icon-precomposed.png"> <meta name="msapplication-TileImage" content="/assets/img/msapplication_tileimage.png"/> <meta name="msapplication-TileColor" content="#fabb00"> <!-- Facebook Optimization --> <meta property="og:locale" content="en_EN" /> <meta property="og:type" content="website" /> <meta property="og:title" content="深入研究KJBitmap使用方法" /> <meta property="og:description" content="无论何时，请保持学者的谦逊与宽容。"/> <meta property="og:url" content="//KJBitmap/" /> <meta property="og:site_name" content="kymjs张涛" /> <!-- Search Engine Optimization --> <link type="text/plain" rel="author" href="//humans.txt" /> </head> <body id="top-of-page" class="page-fullwidth"> <div id="navigation" class="sticky"> <nav class="top-bar" data-topbar> <ul class="title-area"> <li class="name"> <h1 class="show-for-small-only"><a href="" class="icon-tree"> kymjs张涛</a></h1> </li> <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone --> <li class="toggle-topbar menu-icon"><a href="#"><span>Navigation</span></a></li> </ul> <section class="top-bar-section"> <ul class="right"> <li class="divider"></li> <li><a href="/donate">捐赠</a></li> <li class="divider"></li> <li><a href="/about">这是我</a></li> </ul> <ul class="left"> <li class="has-dropdown"> <a href="/code">代码与技术</a> <ul class="dropdown"> <li><a href="/code/android">Android</a></li> <li><a href="/code/ios">IOS</a></li> <li><a href="/code/algorithm">算法</a></li> </ul> </li> <li class="divider"></li> <li><a href="/product">产品体验分析</a></li> <li class="divider"></li> <li><a href="/read">阅读与感悟</a></li> <li class="divider"></li> <li><a href="/manager">开发团队管理</a></li> <li class="divider"></li> <li class="has-dropdown"> <a href="/osl">开源实验室</a> <ul class="dropdown"> <li><a href="/osl/framework">Android框架解读</a></li> <li><a href="/osl/ui">UI控件</a></li> <li><a href="/osl/app">开源APP</a></li> </ul> </li> <li class="divider"></li> </ul> </section> </nav> </div><!-- /#navigation --> <div class="row t30"> <div class="medium-12 columns"> <article> <header> <p class="subheadline">代码与技术</p> <h1>深入研究KJBitmap使用方法</h1> </header> <p class="teaser"> 好像最近一个月都没有写博客了，正好伴着KJFrameForAndroid更新v2.14版本，讲解一下其中Bitmap模块的深度用法。 </p> <h2 id="section">摘要</h2> <p>好像最近一个月都没有写博客了，正好伴着<a href="http://github.com/kymjs/KJFrameForAndroid">KJFrameForAndroid</a> 更新v2.14版本，讲解一下其中Bitmap模块的深度用法。<br /> 首先介绍一下：KJBitmap是一个帮助Android开发者加载网络图片的类库。使用KJBitmap可以很方便的加载网络图片，而不用考虑对图片缓存以及OOM问题的处理(因为框架都帮你做好了)。</p> <h2 id="section-1">基础用法</h2> <p>最简单的加载方法是kjb.display(view, url); <br /> 其中kjb就是KJBitmap类的对象; <br /> 参数view可以代表任何View，对imageView设置它的src资源，对普通View会设置背景图片;<br /> 参数url就是这个图片的网络地址了，这里支持传一个网络地址如 http://www.kymjs.com/logo.png，同样也支持一个SD卡路径比如/storage/sdcard0/logo.png</p> <h2 id="section-2">重载的显示方法</h2> <p>kjb.display(view, url, width, height);<br /> 这个方法可以加载指定大小的图片，比如我们有时候需要显示一个非常大的图片，但是手机的屏幕实际上是很小的，如果把整张图片都加载进来，不仅浪费内存而且加载速度很慢(但是消耗的流量是一样的,因为都需要把原图下载到本地) 其实如果是使用的单独加载一个控件是不需要用这个方法的，因为框架会自动获取到当前控件的宽高，并使用控件的宽高作为图片要显示的大小。但是还有一个问题就是如果控件还没有在屏幕上显示就调用加载逻辑，比如在Activity的onCreate()方法中调用display()方法；比如在ListView中调用display()方法；这些时候是获取不到控件的宽高的，框架默认会以当前屏幕大小的一半作为图片的大小加载，而如果你指定了这个大小，则会以指定大小显示。<br /> kjb.display(view, url, loadimage);<br /> 很多时候，我们需要在图片加载的过程中先显示一个还没有加载出来的灰色图片，这个时候就可以使用这个方法。这里需要提的就是，KJBitmap非常先进，不会像ImageLoader框架一样造成图片闪烁问题。<br /></p> <h2 id="section-3">使用配置器</h2> <p>网络图片的加载会自动将图片缓存在本地SD卡中，默认路径是/KJLibrary/image，当然，这个路径是你可以修改的。<br /></p> <div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">BitmapConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="kp">new</span> <span class="no">BitmapConfig</span><span class="p">();</span>
            <span class="n">config</span><span class="o">.</span><span class="n">memoryCacheSize</span><span class="p">;</span> <span class="sr">//</span><span class="err">设置图片内存缓存空间大小，默认是手机内存的大小</span>
            <span class="n">config</span><span class="o">.</span><span class="n">diskCacheSize</span><span class="p">;</span> <span class="sr">//</span> <span class="err">设置图片</span><span class="no">SD</span><span class="err">卡缓存空间大小，默认</span><span class="mi">40</span><span class="n">M</span>
            <span class="n">config</span><span class="o">.</span><span class="n">isDEBUG</span><span class="p">;</span> <span class="sr">//</span><span class="err">当前是否是调试模式，会打印一些调试</span><span class="n">log</span><span class="err">信息</span>
  <span class="sr">//</span><span class="err">如下设置会将图片缓存到</span><span class="no">SD</span><span class="err">卡根目录的</span><span class="no">KJBitmap</span><span class="err">文件夹内的</span><span class="n">cache</span><span class="err">文件夹中</span>
 <span class="no">BitmapConfig</span><span class="o">.</span><span class="n">CACHEPATH</span> <span class="o">=</span> <span class="s2">&quot;KJBitmap/cache&quot;</span><span class="p">;</span> <span class="sr">//</span><span class="err">这个就是我们图片缓存的路径了</span></code></pre></div> <p>最后别忘了，还有最重要的一步就是应用你的设置。<br /> KJBitmap kjb = KJBitmap.create(config);</p> <h2 id="section-4">自定义图片显示过程</h2> <p>在加载图片的过程中，还可以给一些酷炫的效果。比如让这张图片显示过程中添加一个动画，让图片从中心显示逐渐放大显示出来；比如让图片渐变，从模糊到清晰的显示；亦或者让图片显示时先显示一个环形进度条，等图片加载完成后再显示图片。这些自定义效果完全可行，你只需要在display()中调用Callback传入你的自定义加载过程就行了：<br /></p> <div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">kjbitmap</span><span class="o">.</span><span class="na">display</span><span class="o">(</span><span class="n">vh</span><span class="o">.</span><span class="na">image</span><span class="o">,</span> <span class="n">url</span><span class="o">,</span> <span class="k">new</span> <span class="nf">BitmapCallBack</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPreLoad</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">.</span><span class="na">onPreLoad</span><span class="o">(</span><span class="n">view</span><span class="o">);</span>
            <span class="n">bar</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFinish</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">.</span><span class="na">onFinish</span><span class="o">(</span><span class="n">view</span><span class="o">);</span>
            <span class="n">bar</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="n">Exception</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Viewinjext</span><span class="o">.</span><span class="na">toast</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">tip_load_image_faile</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">});</span></code></pre></div> <h2 id="section-5">远不止这些</h2> <p>作为一个灵活的开放式框架，KJBitmap能做的当然不止这些，还支持：<br /> //保存一张网络图片到本地<br /> public void saveImage(String url, String path);<br /> //对本地缓存的读写(包括删除)<br /> public Bitmap getBitmapFromCache(String key);<br /> public void removeCache(String key);<br /> public void removeCacheAll();<br /></p> <p>更多的用法期待大家去发现，在使用过程中如果有不明白的函数方法，可以参考<a href="http://kjframe.github.io">API文档</a></p> </article> </div><!-- /.medium-12.columns --> </div><!-- /.row --> <div id="up-to-top" class="row"> <div class="small-12 columns" style="text-align: right;"> <a class="iconfont" href="#top-of-page">&#xf108;</a> </div><!-- /.small-12.columns --> </div><!-- /.row --> <footer id="footer-content" class="bg-grau"> <div id="footer"> <div class="row"> <div class="medium-6 large-5 columns"> <h5 class="shadow-black">公众号：Android技术分享</h5> <p class="shadow-black"> <img src="/images/qrcode.jpg" alt="无论何时，请保持学者的谦逊与宽容。" width="120" height="120"/> </p> </div><!-- /.large-6.columns --> <div class="small-6 medium-3 large-3 large-offset-1 columns"> <h5 class="shadow-black">推荐站点</h5> <ul class="no-bullet shadow-black"> <li > <a href="" title=""></a> </li> <li class="services-contact" > <a href="/android_design" title="Android应用设计指南">Android应用设计指南</a> </li> <li class="services-contact" > <a href="/kjframe" title="KJFrame框架 API">KJFrameForAndroid API</a> </li> </ul> </div><!-- /.large-4.columns --> <div class="small-6 medium-3 large-3 columns"> <h5 class="shadow-black">推荐博客</h5> <ul class="no-bullet shadow-black"> <li > <a href="" title=""></a> </li> <li class="network-entypo" > <a href="http://www.xiequan.info/" target="_blank" title="谢权">Android达人-谢权</a> </li> <li class="services-newsletter" > <a href="http://www.vmatianyu.cn/" target="_blank" title="马天宇博客">bong智能：马天宇</a> </li> <li class="rss-link" > <a href="http://www.aplesson.com/" target="_blank" title="Android+PHP=APlesson">开源爱好者：谭东</a> </li> <li class="sitemap-link" > <a href="http://blog.csdn.net/bboyfeiyu" target="_blank" title="Mr.Simple">Mr.Simple博客</a> </li> </ul> </div><!-- /.large-3.columns --> </div><!-- /.row --> </div><!-- /#footer --> <div id="subfooter"> <nav class="row"> <section id="subfooter-left" class="b30 small-12 medium-6 columns"> <ul class="inline-list"> <li>站务联系 QQ:766136833 </li> </ul> </section> <section id="subfooter-right" class="small-12 medium-6 columns social-icons"> <ul class="inline-list"> <li><a href="http://twitter.com/kymjs123" target="_blank" class="icon-twitter" title="Twitter"></a></li> <li><a href="http://github.com/kymjs" target="_blank" class="icon-github" title="Code"></a></li> <li><a href="http://www.kymjs.com/" target="_blank" class="icon-xing" title="张涛"></a></li> </ul> </section> </nav> </div><!-- /#subfooter --> </footer> <script src="/assets/js/javascript.min.js"></script> </body> </html>
