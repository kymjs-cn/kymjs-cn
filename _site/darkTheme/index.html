<!doctype html> <html class="no-js" lang="en"> <head> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <title>Android夜间模式实现</title> <link rel="stylesheet" href="/assets/css/styles_feeling_responsive.css"> <script src="/assets/js/modernizr.min.js"></script> <noscript> <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic%7cVolkhov' rel='stylesheet' type='text/css'> </noscript> <meta name="description" content="最近在做一个Android夜间模式的功能，又重新研究了一下Theme机制。贯彻我的风格，以解决问题为目标，写了个小Demo，简单了实现了切换夜间模式，为大家讲解。"/> <link rel="author" href="https://plus.google.com/u/0/110645272912875945931"/> <link rel="icon" sizes="32x32" href="/assets/img/favicon-32x32.png"> <link rel="icon" sizes="192x192" href="/assets/img/touch-icon-192x192.png"> <link rel="apple-touch-icon-precomposed" sizes="180x180" href="/assets/img/apple-touch-icon-180x180-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/img/apple-touch-icon-152x152-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/img/apple-touch-icon-144x144-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/img/apple-touch-icon-120x120-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/img/apple-touch-icon-114x114-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/img/apple-touch-icon-76x76-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/img/apple-touch-icon-72x72-precomposed.png"> <link rel="apple-touch-icon-precomposed" href="/assets/img/apple-touch-icon-precomposed.png"> <meta name="msapplication-TileImage" content="/assets/img/msapplication_tileimage.png"/> <meta name="msapplication-TileColor" content="#fabb00"> <!-- Facebook Optimization --> <meta property="og:locale" content="en_EN" /> <meta property="og:type" content="website" /> <meta property="og:title" content="Android夜间模式实现" /> <meta property="og:description" content="无论何时，请保持学者的谦逊与宽容。"/> <meta property="og:url" content="//darkTheme/" /> <meta property="og:site_name" content="kymjs张涛" /> <!-- Search Engine Optimization --> <link type="text/plain" rel="author" href="//humans.txt" /> </head> <body id="top-of-page" class="page-fullwidth"> <div id="navigation" class="sticky"> <nav class="top-bar" data-topbar> <ul class="title-area"> <li class="name"> <h1 class="show-for-small-only"><a href="" class="icon-tree"> kymjs张涛</a></h1> </li> <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone --> <li class="toggle-topbar menu-icon"><a href="#"><span>Navigation</span></a></li> </ul> <section class="top-bar-section"> <ul class="right"> <li class="divider"></li> <li><a href="/donate">捐赠</a></li> <li class="divider"></li> <li><a href="/about">这是我</a></li> </ul> <ul class="left"> <li class="has-dropdown"> <a href="/code">代码与技术</a> <ul class="dropdown"> <li><a href="/code/android">Android</a></li> <li><a href="/code/ios">IOS</a></li> <li><a href="/code/algorithm">算法</a></li> </ul> </li> <li class="divider"></li> <li><a href="/product">产品体验分析</a></li> <li class="divider"></li> <li><a href="/read">阅读与感悟</a></li> <li class="divider"></li> <li><a href="/manager">开发团队管理</a></li> <li class="divider"></li> <li class="has-dropdown"> <a href="/osl">开源实验室</a> <ul class="dropdown"> <li><a href="/osl/framework">Android框架解读</a></li> <li><a href="/osl/ui">UI控件</a></li> <li><a href="/osl/app">开源APP</a></li> </ul> </li> <li class="divider"></li> </ul> </section> </nav> </div><!-- /#navigation --> <div class="row t30"> <div class="medium-12 columns"> <article> <header> <p class="subheadline">代码与技术</p> <h1>Android夜间模式实现</h1> </header> <p class="teaser"> 最近在做一个Android夜间模式的功能，又重新研究了一下Theme机制。贯彻我的风格，以解决问题为目标，写了个小Demo，简单了实现了切换夜间模式，为大家讲解。 </p> <p>最近在做一个Android夜间模式的功能，又重新研究了一下Theme机制。贯彻我的风格，以解决问题为目标，写了个小Demo，简单了实现了切换夜间模式，为大家讲解。<br /> 在Activity中有一个方法叫setTheme()，可以设置Activity的Theme，当然Application类中也有相同的方法，也可以在Application中设置当前应用的Theme。就好像我们可以在Manifest文件中通过android:theme=“”来设置主题一样。</p> <h2 id="section">创建属性名</h2> <p>在工程目录res/values/下新建一个xml文件，名字可以自定义，这里我的叫theme_attr.xml 内容如下：</p> <div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
	<span class="nt">&lt;resources&gt;</span>
	    <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">&quot;text_bg&quot;</span> <span class="na">format=</span><span class="s">&quot;reference|color&quot;</span><span class="nt">/&gt;</span>
	    <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">&quot;bottom_bg&quot;</span> <span class="na">format=</span><span class="s">&quot;reference|color&quot;</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;/resources&gt;</span></code></pre></div> <table> <tbody> <tr> <td>其中text_bg和bottom_bg就是我们定义的两个属性名，后面的format是指的这个属性名的类型，这里我是用reference</td> <td>color表示既可以是一个引用，也可以是一个argb颜色值。除了这些你还可以选择int，boolan，string等数据类型。</td> </tr> </tbody> </table> <h2 id="section-1">定义资源样式</h2> <p>创建完属性名后就需要创建主题样式了。依旧在res/values/下新建一个xml文件，或者也可以在原style.xml中写，是一样的。这里为了项目结构清晰，就单独写一个文件叫theme_dark.xml 我们需要在这里定义步骤一中定义的各属性名在当前主题下的值。</p> <div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;resources&gt;</span>
	    <span class="c">&lt;!-- Base application theme. --&gt;</span>
	    <span class="nt">&lt;style</span> <span class="na">name=</span><span class="s">&quot;DarkTheme&quot;</span> <span class="na">parent=</span><span class="s">&quot;@android:style/Theme&quot;</span><span class="nt">&gt;</span>
	        <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;text_bg&quot;</span><span class="nt">&gt;</span>@drawable/selector_text_bg_dark<span class="nt">&lt;/item&gt;</span>
	        <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;bottom_bg&quot;</span><span class="nt">&gt;</span>@drawable/bg_bottombar_dark<span class="nt">&lt;/item&gt;</span>
	    <span class="nt">&lt;/style&gt;</span>
	<span class="nt">&lt;/resources&gt;</span></code></pre></div> <p>需要注意的是，我们自己定义的style必须直接或间接继承系统的Theme，否则很多系统主题找不到就会报错。<br /> 还有一点，我们声明了两个属性，这里一定要记得都把值定义了，如果不定义也不会错。但是如果在代码中引用了相应的属性，而这个主题没有定义这个属性的值会运行出错的。<br /> 这里可以看到因为上面我属性类型定义了引用或颜色，所以这里的值我既可以传@drawable类型的引用也可以直接赋值一个#ff00ff这样的颜色值。</p> <h2 id="section-2">布局中使用</h2> <p>布局文件中使用我们自定义的文件时，需要添加一个问号来表示引用。例如</p> <div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
          <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
          <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
          <span class="na">android:orientation=</span><span class="s">&quot;vertical&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;Button</span>
	        <span class="na">android:id=</span><span class="s">&quot;@+id/login_btn&quot;</span>
	        <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
	        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
	        <span class="na">android:background=</span><span class="s">&quot;?text_bg&quot;</span>
	        <span class="na">android:text=</span><span class="s">&quot;登录&quot;</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;/LinearLayout&gt;</span></code></pre></div> <p>这样就表示我们的登录按钮的背景使用的是前面定义的属性名text_bg在当前主题下的值，也就是我们步骤二中定义的@drawable/selector_text_bg_dark这张图片(其实是一个选择器了)</p> <h2 id="section-3">代码中使用</h2> <p>以一个最简单的例子来说明了，需要注意的是一定要在Activity的setContentView调用之前调用setTheme()方法。网上有很多介绍都说的是在super之前，其实这种说法并不准确。当我们动态切换主题时，例如点击某个按钮，切换主题，这个时候需要再次手动调用setContentView()方法，并重新调用控件初始化以及监听器设置。但是这里告诉你一种简单方法：直接手动调用recreate()方法，再次创建视图就可以了。</p> <div class="highlight"><pre><code class="language-xml" data-lang="xml">public class UserInfor extends KJActivity {
	    @BindView(id = R.id.logout_btn, click = true)
	    private Button mBtnLogout;

	    @Override
	    public void setRootView() {
	        setContentView(R.layout.activity_userinfor);
	    }

	    @Override
	    public void widgetClick(View v) {
	        super.widgetClick(v);
	        switch (v.getId()) {
	            case R.id.logout_btn:
	                setTheme(R.style.DarkTheme);
	                recreate();
	                break;
	        }
	    }
	}</code></pre></div> </article> </div><!-- /.medium-12.columns --> </div><!-- /.row --> <div id="up-to-top" class="row"> <div class="small-12 columns" style="text-align: right;"> <a class="iconfont" href="#top-of-page">&#xf108;</a> </div><!-- /.small-12.columns --> </div><!-- /.row --> <footer id="footer-content" class="bg-grau"> <div id="footer"> <div class="row"> <div class="medium-6 large-5 columns"> <h5 class="shadow-black">公众号：Android技术分享</h5> <p class="shadow-black"> <img src="/images/qrcode.jpg" alt="无论何时，请保持学者的谦逊与宽容。" width="120" height="120"/> </p> </div><!-- /.large-6.columns --> <div class="small-6 medium-3 large-3 large-offset-1 columns"> <h5 class="shadow-black">推荐站点</h5> <ul class="no-bullet shadow-black"> <li > <a href="" title=""></a> </li> <li class="services-contact" > <a href="/android_design" title="Android应用设计指南">Android应用设计指南</a> </li> <li class="services-contact" > <a href="/kjframe" title="KJFrame框架 API">KJFrameForAndroid API</a> </li> </ul> </div><!-- /.large-4.columns --> <div class="small-6 medium-3 large-3 columns"> <h5 class="shadow-black">推荐博客</h5> <ul class="no-bullet shadow-black"> <li > <a href="" title=""></a> </li> <li class="network-entypo" > <a href="http://www.xiequan.info/" target="_blank" title="谢权">Android达人-谢权</a> </li> <li class="services-newsletter" > <a href="http://www.vmatianyu.cn/" target="_blank" title="马天宇博客">bong智能：马天宇</a> </li> <li class="rss-link" > <a href="http://www.aplesson.com/" target="_blank" title="Android+PHP=APlesson">开源爱好者：谭东</a> </li> <li class="sitemap-link" > <a href="http://blog.csdn.net/bboyfeiyu" target="_blank" title="Mr.Simple">Mr.Simple博客</a> </li> </ul> </div><!-- /.large-3.columns --> </div><!-- /.row --> </div><!-- /#footer --> <div id="subfooter"> <nav class="row"> <section id="subfooter-left" class="b30 small-12 medium-6 columns"> <ul class="inline-list"> <li>站务联系 QQ:766136833 </li> </ul> </section> <section id="subfooter-right" class="small-12 medium-6 columns social-icons"> <ul class="inline-list"> <li><a href="http://twitter.com/kymjs123" target="_blank" class="icon-twitter" title="Twitter"></a></li> <li><a href="http://github.com/kymjs" target="_blank" class="icon-github" title="Code"></a></li> <li><a href="http://www.kymjs.com/" target="_blank" class="icon-xing" title="张涛"></a></li> </ul> </section> </nav> </div><!-- /#subfooter --> </footer> <script src="/assets/js/javascript.min.js"></script> </body> </html>
