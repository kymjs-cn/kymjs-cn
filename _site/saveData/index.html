<!doctype html> <html class="no-js" lang="en"> <head> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <title>如何在Android应用程序中保存数据</title> <link rel="stylesheet" href="/assets/css/styles_feeling_responsive.css"> <script src="/assets/js/modernizr.min.js"></script> <noscript> <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic%7cVolkhov' rel='stylesheet' type='text/css'> </noscript> <meta name="description" content="一些日常总结的笔记与经验~ "/> <link rel="author" href="https://plus.google.com/u/0/110645272912875945931"/> <link rel="icon" sizes="32x32" href="/assets/img/favicon-32x32.png"> <link rel="icon" sizes="192x192" href="/assets/img/touch-icon-192x192.png"> <link rel="apple-touch-icon-precomposed" sizes="180x180" href="/assets/img/apple-touch-icon-180x180-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/img/apple-touch-icon-152x152-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/img/apple-touch-icon-144x144-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/img/apple-touch-icon-120x120-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/img/apple-touch-icon-114x114-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/img/apple-touch-icon-76x76-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/img/apple-touch-icon-72x72-precomposed.png"> <link rel="apple-touch-icon-precomposed" href="/assets/img/apple-touch-icon-precomposed.png"> <meta name="msapplication-TileImage" content="/assets/img/msapplication_tileimage.png"/> <meta name="msapplication-TileColor" content="#fabb00"> <!-- Facebook Optimization --> <meta property="og:locale" content="en_EN" /> <meta property="og:type" content="website" /> <meta property="og:title" content="如何在Android应用程序中保存数据" /> <meta property="og:description" content="无论何时，请保持学者的谦逊与宽容。"/> <meta property="og:url" content="//saveData/" /> <meta property="og:site_name" content="kymjs张涛" /> <!-- Search Engine Optimization --> <link type="text/plain" rel="author" href="//humans.txt" /> </head> <body id="top-of-page" class="page-fullwidth"> <div id="navigation" class="sticky"> <nav class="top-bar" data-topbar> <ul class="title-area"> <li class="name"> <h1 class="show-for-small-only"><a href="" class="icon-tree"> kymjs张涛</a></h1> </li> <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone --> <li class="toggle-topbar menu-icon"><a href="#"><span>Navigation</span></a></li> </ul> <section class="top-bar-section"> <ul class="right"> <li class="divider"></li> <li><a href="/donate">捐赠</a></li> <li class="divider"></li> <li><a href="/about">这是我</a></li> </ul> <ul class="left"> <li class="has-dropdown"> <a href="/code">代码与技术</a> <ul class="dropdown"> <li><a href="/code/android">Android</a></li> <li><a href="/code/ios">IOS</a></li> <li><a href="/code/algorithm">算法</a></li> </ul> </li> <li class="divider"></li> <li><a href="/product">产品体验分析</a></li> <li class="divider"></li> <li><a href="/read">阅读与感悟</a></li> <li class="divider"></li> <li><a href="/manager">开发团队管理</a></li> <li class="divider"></li> <li class="has-dropdown"> <a href="/osl">开源实验室</a> <ul class="dropdown"> <li><a href="/osl/framework">Android框架解读</a></li> <li><a href="/osl/ui">UI控件</a></li> <li><a href="/osl/app">开源APP</a></li> </ul> </li> <li class="divider"></li> </ul> </section> </nav> </div><!-- /#navigation --> <div class="row t30"> <div class="medium-12 columns"> <article> <header> <p class="subheadline">代码与技术</p> <h1>如何在Android应用程序中保存数据</h1> </header> <p class="teaser"> 一些日常总结的笔记与经验~ </p> <p>这是关于在应用中保存数据和应用状态系列文章中的一篇。在安卓SDK中有许多机制可以用来保存数据，决定使用哪一种和何时触发该操作常让人困惑。当创建个人应用程序的时候你想要做的第一件、最容易的事就是保存一些用户输入的、明确需要保存的数据。下面是一些常用来持久化存储的方法：</p> <ol> <li>数据保存最基本的方法就是保存到外置存储设备的文件上。这种存储可以被用户和所有的应用程序获得，当设备当作外置存储挂在的时候也可以看到。即使你的应用卸载了该文件也会一直保留，除非你用getExternalFileDir方法获得保存文件的文件夹。这最适用于被用户编辑过的文件，即使应用卸载了也最好一直保留着，例如图片和文档。</li> <li>你也可以把文件保存为内部存储，例如getFilesDir方法。这对于你的应用程序是私有的。这种情况下，用户和其他应用程序都得到这些文件，并且当你应用卸载的时候文件将被删除。这最适用于保存一些简单的数据，避免了处理数据库的开销。</li> <li>另外，你也可以把用户的配置保存成 键/值对，使用Preference API来创建SharedPreferences文件。你可以创建一个PreferenceActivity或者包含PreferenceFragment的Activity保存参数配置，他们的布局中都有Preferences 对象来代替View对象。</li> <li>最后，如果你要保存的数据结构很复杂，每个应用都有自己的私有的SQLLite数据库来保存数据。如果你的应用被卸载，这些数据也将被销毁。经常看到有朋友动辄上千的数据存在数据库中。我个人是并不推荐使用数据库来保存数据，一方面是客户端并没有什么重要的关键数据，二来数据库的存储读写比起文件要慢很多。</li> </ol> <p>另外，有些情况需要保存应用程序的当前状态，因为某个事件被触发。例如：<br /> 1. 当设备被旋转的时候，当前的Activity被重新创建，布局也被调整。<br /> 2. 当你的应用被用户或者其他应用放到后台去运行的时候，例如手机接到一个电话。另外，用户打开了应用程序的另一个Activity，当前的Activity也会被放到后台。任何在后台运行的Activity当内存不足的时候都可能被回收，当需要的时候再被重新创建。 当用户明确地关闭了应用。</p> <p>以上的情况，你都需要持久化保存用户输入的数据。当Activity被放到后台或者在销毁的过程中，onPause方法总是被调用，紧接着是onStop即使UI被完全隐藏。所以最好在OnPause方法中保存数据。随后，当用户再次接触之前的Activity，如果它仍在内存中onRestart，onstart和onResume方法将被调用，如果已经被回收了就需要被重新常见，那么onCreate、onStart、和onResume将被调用。所以如果你想在所有情况下都再次显示之前的数据，你应该在onResume方法中恢复UI。</p> <p>如果不需要永久的保存数据而只想保存UI的状态，你可以在onSaveInstanceState方法中把数据保存在Bundle中。该方法不能用来保存数据，因为它不是Activity生命周期的一部分，仅仅当Activity需要重新创建或者被放到后台的时候被UI事件触发，被永久销毁的时候该方法不被调用。所以它仅用于保存一些暂时性View状态。<br /> 有些数据已经被安卓SDK保存了，但你可能需要保存些额外的信息，例如，假如你有些自定义的控制，当用户按返回键回到Activity的时候，UI的状态需要被恢复，如果Activity仍在内存中，保存有状态信息的bundle对象可以在onRestoreInstanceState方法中获得，如果Activity被回收了需要重新创建，可以在onCreate方法中获得bundle对象。</p> </article> </div><!-- /.medium-12.columns --> </div><!-- /.row --> <div id="up-to-top" class="row"> <div class="small-12 columns" style="text-align: right;"> <a class="iconfont" href="#top-of-page">&#xf108;</a> </div><!-- /.small-12.columns --> </div><!-- /.row --> <footer id="footer-content" class="bg-grau"> <div id="footer"> <div class="row"> <div class="medium-6 large-5 columns"> <h5 class="shadow-black">公众号：Android技术分享</h5> <p class="shadow-black"> <img src="/images/qrcode.jpg" alt="无论何时，请保持学者的谦逊与宽容。" width="120" height="120"/> </p> </div><!-- /.large-6.columns --> <div class="small-6 medium-3 large-3 large-offset-1 columns"> <h5 class="shadow-black">推荐站点</h5> <ul class="no-bullet shadow-black"> <li > <a href="" title=""></a> </li> <li class="services-contact" > <a href="/android_design" title="Android应用设计指南">Android应用设计指南</a> </li> <li class="services-contact" > <a href="/kjframe" title="KJFrame框架 API">KJFrameForAndroid API</a> </li> </ul> </div><!-- /.large-4.columns --> <div class="small-6 medium-3 large-3 columns"> <h5 class="shadow-black">推荐博客</h5> <ul class="no-bullet shadow-black"> <li > <a href="" title=""></a> </li> <li class="network-entypo" > <a href="http://www.xiequan.info/" target="_blank" title="谢权">Android达人-谢权</a> </li> <li class="services-newsletter" > <a href="http://www.vmatianyu.cn/" target="_blank" title="马天宇博客">bong智能：马天宇</a> </li> <li class="rss-link" > <a href="http://www.aplesson.com/" target="_blank" title="Android+PHP=APlesson">开源爱好者：谭东</a> </li> <li class="sitemap-link" > <a href="http://blog.csdn.net/bboyfeiyu" target="_blank" title="Mr.Simple">Mr.Simple博客</a> </li> </ul> </div><!-- /.large-3.columns --> </div><!-- /.row --> </div><!-- /#footer --> <div id="subfooter"> <nav class="row"> <section id="subfooter-left" class="b30 small-12 medium-6 columns"> <ul class="inline-list"> <li>站务联系 QQ:766136833 </li> </ul> </section> <section id="subfooter-right" class="small-12 medium-6 columns social-icons"> <ul class="inline-list"> <li><a href="http://twitter.com/kymjs123" target="_blank" class="icon-twitter" title="Twitter"></a></li> <li><a href="http://github.com/kymjs" target="_blank" class="icon-github" title="Code"></a></li> <li><a href="http://www.kymjs.com/" target="_blank" class="icon-xing" title="张涛"></a></li> </ul> </section> </nav> </div><!-- /#subfooter --> </footer> <script src="/assets/js/javascript.min.js"></script> </body> </html>
