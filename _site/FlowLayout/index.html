<!doctype html> <html class="no-js" lang="en"> <head> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <title>Android流式布局实现</title> <link rel="stylesheet" href="/assets/css/styles_feeling_responsive.css"> <script src="/assets/js/modernizr.min.js"></script> <noscript> <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic%7cVolkhov' rel='stylesheet' type='text/css'> </noscript> <meta name="description" content="新项目用到了一种全新布局————Android标签流式布局的功能，正好一直说给大家讲自定义控件的实现，今天就为大家讲一种android流式布局的实现。"/> <link rel="author" href="https://plus.google.com/u/0/110645272912875945931"/> <link rel="icon" sizes="32x32" href="/assets/img/favicon-32x32.png"> <link rel="icon" sizes="192x192" href="/assets/img/touch-icon-192x192.png"> <link rel="apple-touch-icon-precomposed" sizes="180x180" href="/assets/img/apple-touch-icon-180x180-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/img/apple-touch-icon-152x152-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/img/apple-touch-icon-144x144-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/img/apple-touch-icon-120x120-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/img/apple-touch-icon-114x114-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/img/apple-touch-icon-76x76-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/img/apple-touch-icon-72x72-precomposed.png"> <link rel="apple-touch-icon-precomposed" href="/assets/img/apple-touch-icon-precomposed.png"> <meta name="msapplication-TileImage" content="/assets/img/msapplication_tileimage.png"/> <meta name="msapplication-TileColor" content="#fabb00"> <!-- Facebook Optimization --> <meta property="og:locale" content="en_EN" /> <meta property="og:type" content="website" /> <meta property="og:title" content="Android流式布局实现" /> <meta property="og:description" content="无论何时，请保持学者的谦逊与宽容。"/> <meta property="og:url" content="//FlowLayout/" /> <meta property="og:site_name" content="kymjs张涛" /> <!-- Search Engine Optimization --> <link type="text/plain" rel="author" href="//humans.txt" /> </head> <body id="top-of-page" class="page-fullwidth"> <div id="navigation" class="sticky"> <nav class="top-bar" data-topbar> <ul class="title-area"> <li class="name"> <h1 class="show-for-small-only"><a href="" class="icon-tree"> kymjs张涛</a></h1> </li> <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone --> <li class="toggle-topbar menu-icon"><a href="#"><span>Navigation</span></a></li> </ul> <section class="top-bar-section"> <ul class="right"> <li class="divider"></li> <li><a href="/donate">捐赠</a></li> <li class="divider"></li> <li><a href="/about">这是我</a></li> </ul> <ul class="left"> <li class="has-dropdown"> <a href="/code">代码与技术</a> <ul class="dropdown"> <li><a href="/code/android">Android</a></li> <li><a href="/code/ios">IOS</a></li> <li><a href="/code/algorithm">算法</a></li> </ul> </li> <li class="divider"></li> <li><a href="/product">产品体验分析</a></li> <li class="divider"></li> <li><a href="/read">阅读与感悟</a></li> <li class="divider"></li> <li><a href="/manager">开发团队管理</a></li> <li class="divider"></li> <li class="has-dropdown"> <a href="/osl">开源实验室</a> <ul class="dropdown"> <li><a href="/osl/framework">Android框架解读</a></li> <li><a href="/osl/ui">UI控件</a></li> <li><a href="/osl/app">开源APP</a></li> </ul> </li> <li class="divider"></li> </ul> </section> </nav> </div><!-- /#navigation --> <div class="row t30"> <div class="medium-12 columns"> <article> <header> <p class="subheadline">代码与技术</p> <h1>Android流式布局实现</h1> </header> <p class="teaser"> 新项目用到了一种全新布局————Android标签流式布局的功能，正好一直说给大家讲自定义控件的实现，今天就为大家讲一种android流式布局的实现。 </p> <p>在日常的app使用中，我们会在android 的app中看见热门标签等自动换行的流式布局，今天，我们就来看看如何自定义一个类似热门标签那样的流式布局吧（源码下载在下面最后给出）<br /> <a href="http://www.kymjs.com/"><img src="/images/blog_image/20150606_1.jpg" alt="OpenSourceLaboratory" /></a><br /> 这个控件并不是我实现的，代码是从网上搜流式布局找到的。我只是为大家讲解一下实现过程以及原理。</p> <h2 id="section">先看代码</h2> <div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FlowLayout</span> <span class="kd">extends</span> <span class="n">ViewGroup</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">float</span> <span class="n">mVerticalSpacing</span><span class="o">;</span> <span class="c1">//每个item纵向间距</span>
    <span class="kd">private</span> <span class="kt">float</span> <span class="n">mHorizontalSpacing</span><span class="o">;</span> <span class="c1">//每个item横向间距</span>

    <span class="kd">public</span> <span class="nf">FlowLayout</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">FlowLayout</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHorizontalSpacing</span><span class="o">(</span><span class="kt">float</span> <span class="n">pixelSize</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mHorizontalSpacing</span> <span class="o">=</span> <span class="n">pixelSize</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setVerticalSpacing</span><span class="o">(</span><span class="kt">float</span> <span class="n">pixelSize</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mVerticalSpacing</span> <span class="o">=</span> <span class="n">pixelSize</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onMeasure</span><span class="o">(</span><span class="kt">int</span> <span class="n">widthMeasureSpec</span><span class="o">,</span> <span class="kt">int</span> <span class="n">heightMeasureSpec</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">selfWidth</span> <span class="o">=</span> <span class="n">resolveSize</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">widthMeasureSpec</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">paddingLeft</span> <span class="o">=</span> <span class="n">getPaddingLeft</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">paddingTop</span> <span class="o">=</span> <span class="n">getPaddingTop</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">paddingRight</span> <span class="o">=</span> <span class="n">getPaddingRight</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">paddingBottom</span> <span class="o">=</span> <span class="n">getPaddingBottom</span><span class="o">();</span>

        <span class="kt">int</span> <span class="n">childLeft</span> <span class="o">=</span> <span class="n">paddingLeft</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">childTop</span> <span class="o">=</span> <span class="n">paddingTop</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">lineHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

        <span class="c1">//通过计算每一个子控件的高度，得到自己的高度</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">childCount</span> <span class="o">=</span> <span class="n">getChildCount</span><span class="o">();</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">childCount</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">View</span> <span class="n">childView</span> <span class="o">=</span> <span class="n">getChildAt</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="n">LayoutParams</span> <span class="n">childLayoutParams</span> <span class="o">=</span> <span class="n">childView</span><span class="o">.</span><span class="na">getLayoutParams</span><span class="o">();</span>
            <span class="n">childView</span><span class="o">.</span><span class="na">measure</span><span class="o">(</span>
                    <span class="n">getChildMeasureSpec</span><span class="o">(</span><span class="n">widthMeasureSpec</span><span class="o">,</span> <span class="n">paddingLeft</span> <span class="o">+</span> <span class="n">paddingRight</span><span class="o">,</span>
                            <span class="n">childLayoutParams</span><span class="o">.</span><span class="na">width</span><span class="o">),</span>
                    <span class="n">getChildMeasureSpec</span><span class="o">(</span><span class="n">heightMeasureSpec</span><span class="o">,</span> <span class="n">paddingTop</span> <span class="o">+</span> <span class="n">paddingBottom</span><span class="o">,</span>
                            <span class="n">childLayoutParams</span><span class="o">.</span><span class="na">height</span><span class="o">));</span>
            <span class="kt">int</span> <span class="n">childWidth</span> <span class="o">=</span> <span class="n">childView</span><span class="o">.</span><span class="na">getMeasuredWidth</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">childHeight</span> <span class="o">=</span> <span class="n">childView</span><span class="o">.</span><span class="na">getMeasuredHeight</span><span class="o">();</span>

            <span class="n">lineHeight</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">childHeight</span><span class="o">,</span> <span class="n">lineHeight</span><span class="o">);</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">childLeft</span> <span class="o">+</span> <span class="n">childWidth</span> <span class="o">+</span> <span class="n">paddingRight</span> <span class="o">&gt;</span> <span class="n">selfWidth</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">childLeft</span> <span class="o">=</span> <span class="n">paddingLeft</span><span class="o">;</span>
                <span class="n">childTop</span> <span class="o">+=</span> <span class="n">mVerticalSpacing</span> <span class="o">+</span> <span class="n">lineHeight</span><span class="o">;</span>
                <span class="n">lineHeight</span> <span class="o">=</span> <span class="n">childHeight</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">childLeft</span> <span class="o">+=</span> <span class="n">childWidth</span> <span class="o">+</span> <span class="n">mHorizontalSpacing</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="kt">int</span> <span class="n">wantedHeight</span> <span class="o">=</span> <span class="n">childTop</span> <span class="o">+</span> <span class="n">lineHeight</span> <span class="o">+</span> <span class="n">paddingBottom</span><span class="o">;</span>
        <span class="n">setMeasuredDimension</span><span class="o">(</span><span class="n">selfWidth</span><span class="o">,</span> <span class="n">resolveSize</span><span class="o">(</span><span class="n">wantedHeight</span><span class="o">,</span> <span class="n">heightMeasureSpec</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onLayout</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">changed</span><span class="o">,</span> <span class="kt">int</span> <span class="n">l</span><span class="o">,</span> <span class="kt">int</span> <span class="n">t</span><span class="o">,</span> <span class="kt">int</span> <span class="n">r</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">myWidth</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="n">l</span><span class="o">;</span>

        <span class="kt">int</span> <span class="n">paddingLeft</span> <span class="o">=</span> <span class="n">getPaddingLeft</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">paddingTop</span> <span class="o">=</span> <span class="n">getPaddingTop</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">paddingRight</span> <span class="o">=</span> <span class="n">getPaddingRight</span><span class="o">();</span>

        <span class="kt">int</span> <span class="n">childLeft</span> <span class="o">=</span> <span class="n">paddingLeft</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">childTop</span> <span class="o">=</span> <span class="n">paddingTop</span><span class="o">;</span>

        <span class="kt">int</span> <span class="n">lineHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

        <span class="c1">//根据子控件的宽高，计算子控件应该出现的位置。</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">childCount</span> <span class="o">=</span> <span class="n">getChildCount</span><span class="o">();</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">childCount</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">View</span> <span class="n">childView</span> <span class="o">=</span> <span class="n">getChildAt</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">childView</span><span class="o">.</span><span class="na">getVisibility</span><span class="o">()</span> <span class="o">==</span> <span class="n">View</span><span class="o">.</span><span class="na">GONE</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">continue</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="kt">int</span> <span class="n">childWidth</span> <span class="o">=</span> <span class="n">childView</span><span class="o">.</span><span class="na">getMeasuredWidth</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">childHeight</span> <span class="o">=</span> <span class="n">childView</span><span class="o">.</span><span class="na">getMeasuredHeight</span><span class="o">();</span>

            <span class="n">lineHeight</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">childHeight</span><span class="o">,</span> <span class="n">lineHeight</span><span class="o">);</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">childLeft</span> <span class="o">+</span> <span class="n">childWidth</span> <span class="o">+</span> <span class="n">paddingRight</span> <span class="o">&gt;</span> <span class="n">myWidth</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">childLeft</span> <span class="o">=</span> <span class="n">paddingLeft</span><span class="o">;</span>
                <span class="n">childTop</span> <span class="o">+=</span> <span class="n">mVerticalSpacing</span> <span class="o">+</span> <span class="n">lineHeight</span><span class="o">;</span>
                <span class="n">lineHeight</span> <span class="o">=</span> <span class="n">childHeight</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">childView</span><span class="o">.</span><span class="na">layout</span><span class="o">(</span><span class="n">childLeft</span><span class="o">,</span> <span class="n">childTop</span><span class="o">,</span> <span class="n">childLeft</span> <span class="o">+</span> <span class="n">childWidth</span><span class="o">,</span> <span class="n">childTop</span> <span class="o">+</span> <span class="n">childHeight</span><span class="o">);</span>
            <span class="n">childLeft</span> <span class="o">+=</span> <span class="n">childWidth</span> <span class="o">+</span> <span class="n">mHorizontalSpacing</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div> <h2 id="section-1">从控件创建过程说起</h2> <ol> <li>当这个流式布局在被加载如内存并显示在屏幕上这一过程中，首先会调用view.measure(w,h)这个方法，表示测量view的宽度与高度，其中参数w与h分别表示这个控件的父控件的宽高。</li> <li>在view.measure()方法的调用过程中又会调用view本身的一个回调方法,onMeasure()，这个是view自身的一个回调方法，用于让开发者在自定义View的时候重新计算自身的大小。一般会在这个方法中循环遍历，计算出这个控件的全部子孙控件的宽高。</li> <li>在View的宽高计算完成以后，考虑将这个控件显示到屏幕的指定位置上，此时view的onLayout()方法会被调用。 一般同时会在这个方法中计算出全部子孙控件在这个控件中的位置。<br /> 可能基本流程有些枯燥，接下来结合代码看看。</li> </ol> <h2 id="section-2">流布局的实现</h2> <p>看到onMeasure()方法中的这段： //通过计算每一个子控件的高度，得到自己的高度</p> <div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">childCount</span> <span class="o">=</span> <span class="n">getChildCount</span><span class="o">();</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">childCount</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
	    <span class="n">View</span> <span class="n">childView</span> <span class="o">=</span> <span class="n">getChildAt</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
	    <span class="n">LayoutParams</span> <span class="n">childLayoutParams</span> <span class="o">=</span> <span class="n">childView</span><span class="o">.</span><span class="na">getLayoutParams</span><span class="o">();</span>
	    <span class="n">childView</span><span class="o">.</span><span class="na">measure</span><span class="o">(</span>
	            <span class="n">getChildMeasureSpec</span><span class="o">(</span><span class="n">widthMeasureSpec</span><span class="o">,</span> <span class="n">paddingLeft</span> <span class="o">+</span> <span class="n">paddingRight</span><span class="o">,</span>
	                    <span class="n">childLayoutParams</span><span class="o">.</span><span class="na">width</span><span class="o">),</span>
	            <span class="n">getChildMeasureSpec</span><span class="o">(</span><span class="n">heightMeasureSpec</span><span class="o">,</span> <span class="n">paddingTop</span> <span class="o">+</span> <span class="n">paddingBottom</span><span class="o">,</span>
	                    <span class="n">childLayoutParams</span><span class="o">.</span><span class="na">height</span><span class="o">));</span>
	    <span class="kt">int</span> <span class="n">childWidth</span> <span class="o">=</span> <span class="n">childView</span><span class="o">.</span><span class="na">getMeasuredWidth</span><span class="o">();</span>
	    <span class="kt">int</span> <span class="n">childHeight</span> <span class="o">=</span> <span class="n">childView</span><span class="o">.</span><span class="na">getMeasuredHeight</span><span class="o">();</span>

	    <span class="n">lineHeight</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">childHeight</span><span class="o">,</span> <span class="n">lineHeight</span><span class="o">);</span>

	    <span class="k">if</span> <span class="o">(</span><span class="n">childLeft</span> <span class="o">+</span> <span class="n">childWidth</span> <span class="o">+</span> <span class="n">paddingRight</span> <span class="o">&gt;</span> <span class="n">selfWidth</span><span class="o">)</span> <span class="o">{</span>
	        <span class="n">childLeft</span> <span class="o">=</span> <span class="n">paddingLeft</span><span class="o">;</span>
	        <span class="n">childTop</span> <span class="o">+=</span> <span class="n">mVerticalSpacing</span> <span class="o">+</span> <span class="n">lineHeight</span><span class="o">;</span>
	        <span class="n">lineHeight</span> <span class="o">=</span> <span class="n">childHeight</span><span class="o">;</span>
	    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
	        <span class="n">childLeft</span> <span class="o">+=</span> <span class="n">childWidth</span> <span class="o">+</span> <span class="n">mHorizontalSpacing</span><span class="o">;</span>
	    <span class="o">}</span>
	<span class="o">}</span></code></pre></div> <p>首先通过循环，遍历这个控件的所有子控件，同时调用子控件的measure()方法，这时measure方法的两个参数是控件能给这个子控件的最大宽高(我们都知道的，子控件再大，显示的大小也不能比父控件还大)。这里getChildMeasureSpec()方法的作用是用来计算一个合适子视图的尺寸大小（宽度或者高度)，结合我们从子视图的LayoutParams所给出的MeasureSpec信息来获取最合适的结果。比如，如果这个View知道自己的大小尺寸（因为它本身的MeasureSpec的model为Exactly,）并且子视图的大小恰好跟父窗口一样大，父窗口必须用给定的大小去layout子视图 <br /> 参数含义：spec 父窗口传递给子视图的大小和模式<br /> padding 父窗口的边距，也就是xml中的android:padding<br /> childDimension 子视图想要绘制的准确大小，但最终不一定绘制此值</p> <p>当得到了每一个子控件的大小以后，再要计算自己的宽高就简单了。<br /> int wantedHeight = childTop + lineHeight + paddingBottom;</p> <p>同理，在onLayout中的这一句</p> <div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">childCount</span> <span class="o">=</span> <span class="n">getChildCount</span><span class="o">();</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">childCount</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
	    <span class="n">View</span> <span class="n">childView</span> <span class="o">=</span> <span class="n">getChildAt</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>

	    <span class="k">if</span> <span class="o">(</span><span class="n">childView</span><span class="o">.</span><span class="na">getVisibility</span><span class="o">()</span> <span class="o">==</span> <span class="n">View</span><span class="o">.</span><span class="na">GONE</span><span class="o">)</span> <span class="o">{</span>
	        <span class="k">continue</span><span class="o">;</span>
	    <span class="o">}</span>

	    <span class="kt">int</span> <span class="n">childWidth</span> <span class="o">=</span> <span class="n">childView</span><span class="o">.</span><span class="na">getMeasuredWidth</span><span class="o">();</span>
	    <span class="kt">int</span> <span class="n">childHeight</span> <span class="o">=</span> <span class="n">childView</span><span class="o">.</span><span class="na">getMeasuredHeight</span><span class="o">();</span>

	    <span class="n">lineHeight</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">childHeight</span><span class="o">,</span> <span class="n">lineHeight</span><span class="o">);</span>

	    <span class="k">if</span> <span class="o">(</span><span class="n">childLeft</span> <span class="o">+</span> <span class="n">childWidth</span> <span class="o">+</span> <span class="n">paddingRight</span> <span class="o">&gt;</span> <span class="n">myWidth</span><span class="o">)</span> <span class="o">{</span>
	        <span class="n">childLeft</span> <span class="o">=</span> <span class="n">paddingLeft</span><span class="o">;</span>
	        <span class="n">childTop</span> <span class="o">+=</span> <span class="n">mVerticalSpacing</span> <span class="o">+</span> <span class="n">lineHeight</span><span class="o">;</span>
	        <span class="n">lineHeight</span> <span class="o">=</span> <span class="n">childHeight</span><span class="o">;</span>
	    <span class="o">}</span>
	    <span class="n">childView</span><span class="o">.</span><span class="na">layout</span><span class="o">(</span><span class="n">childLeft</span><span class="o">,</span> <span class="n">childTop</span><span class="o">,</span> <span class="n">childLeft</span> <span class="o">+</span> <span class="n">childWidth</span><span class="o">,</span> <span class="n">childTop</span> <span class="o">+</span> <span class="n">childHeight</span><span class="o">);</span>
	    <span class="n">childLeft</span> <span class="o">+=</span> <span class="n">childWidth</span> <span class="o">+</span> <span class="n">mHorizontalSpacing</span><span class="o">;</span>
	<span class="o">}</span></code></pre></div> <p>首先通过循环遍历，控制每个item子控件的显示位置，如果当前行还能放得下一个item，就放到当前行，如果放不下就放到下一行的最左边。<br /> 最终，遍历完成，也就相当于把自己的位置显示完成了。</p> <h2 id="section-3">效果截图</h2> <p><a href="http://www.kymjs.com/"><img src="/images/blog_image/20150606_2.gif" alt="OpenSourceLaboratory" /></a></p> </article> </div><!-- /.medium-12.columns --> </div><!-- /.row --> <div id="up-to-top" class="row"> <div class="small-12 columns" style="text-align: right;"> <a class="iconfont" href="#top-of-page">&#xf108;</a> </div><!-- /.small-12.columns --> </div><!-- /.row --> <footer id="footer-content" class="bg-grau"> <div id="footer"> <div class="row"> <div class="medium-6 large-5 columns"> <h5 class="shadow-black">公众号：Android技术分享</h5> <p class="shadow-black"> <img src="/images/qrcode.jpg" alt="无论何时，请保持学者的谦逊与宽容。" width="120" height="120"/> </p> </div><!-- /.large-6.columns --> <div class="small-6 medium-3 large-3 large-offset-1 columns"> <h5 class="shadow-black">推荐站点</h5> <ul class="no-bullet shadow-black"> <li > <a href="" title=""></a> </li> <li class="services-contact" > <a href="/android_design" title="Android应用设计指南">Android应用设计指南</a> </li> <li class="services-contact" > <a href="/kjframe" title="KJFrame框架 API">KJFrameForAndroid API</a> </li> </ul> </div><!-- /.large-4.columns --> <div class="small-6 medium-3 large-3 columns"> <h5 class="shadow-black">推荐博客</h5> <ul class="no-bullet shadow-black"> <li > <a href="" title=""></a> </li> <li class="network-entypo" > <a href="http://www.xiequan.info/" target="_blank" title="谢权">Android达人-谢权</a> </li> <li class="services-newsletter" > <a href="http://www.vmatianyu.cn/" target="_blank" title="马天宇博客">bong智能：马天宇</a> </li> <li class="rss-link" > <a href="http://www.aplesson.com/" target="_blank" title="Android+PHP=APlesson">开源爱好者：谭东</a> </li> <li class="sitemap-link" > <a href="http://blog.csdn.net/bboyfeiyu" target="_blank" title="Mr.Simple">Mr.Simple博客</a> </li> </ul> </div><!-- /.large-3.columns --> </div><!-- /.row --> </div><!-- /#footer --> <div id="subfooter"> <nav class="row"> <section id="subfooter-left" class="b30 small-12 medium-6 columns"> <ul class="inline-list"> <li>站务联系 QQ:766136833 </li> </ul> </section> <section id="subfooter-right" class="small-12 medium-6 columns social-icons"> <ul class="inline-list"> <li><a href="http://twitter.com/kymjs123" target="_blank" class="icon-twitter" title="Twitter"></a></li> <li><a href="http://github.com/kymjs" target="_blank" class="icon-github" title="Code"></a></li> <li><a href="http://www.kymjs.com/" target="_blank" class="icon-xing" title="张涛"></a></li> </ul> </section> </nav> </div><!-- /#subfooter --> </footer> <script src="/assets/js/javascript.min.js"></script> </body> </html>
